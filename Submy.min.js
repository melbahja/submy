/*!
 * Project: Submy
 * Description: JQuery Validation Forms and Ajax Submit Data
 * Author: Mohamed ELbahja 
 * Version: 1.1
 * Licensed under the GPL-3.0 (https://github.com/melbahja/submy/blob/master/LICENSE)
 */
!function(e,s,t,i){"use strict";function r(s,t){if("object"!=typeof t)return this.console().error("SubmyError: options is not object"),!1;this.$submyOptions=i,this.$submyOptions=e.extend({},a,t),this.$submyOptions.messages="messages"in t?e.extend({},n,t.messages):n,this.$submyOptions.fileMessages="fileMessages"in t?e.extend({},m,t.fileMessages):m,this.$submyOptions.htmlMessages="htmlMessages"in t?e.extend({},o,t.htmlMessages):o,this.$submyOptions.ajax="ajax"in t?e.extend({},u,t.ajax):u,this.$submyOptions.rules="rules"in t?t.rules:i,t.messages=t.fileMessages=t.htmlMessages=t.ajax=t.rules=i;try{this.init(s,this)}catch(r){this.console().error(r)}return!1}var a={submitId:"#submit",messageId:"#formMessage",formId:null,validOn:"submit",rules:{},fileUpload:!1,charset:"UTF-8",errConsole:!0,showError:[],jsonDone:!1,done:!1,error:!1},n={required:"this field is required",notValid:"this field is not valid",minTxt:"minimum length is: {{min}}",maxTxt:"maximum length is: {{max}}",minNum:"minimum number is: {{min}}",maxNum:"maximum number is: {{max}}",isEqual:"error in this field",formNotValid:"Please enter correct information"},m={required:"please choose file",minSize:"minimum file size is: {{min}}",maxSize:"maximum file size is: {{max}}",type:"file type is not allowed"},o={message:'<div class="alert alert-{{type}}">{{msg}}<button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button></div>',fail:'<div class="alert alert-danger">Error please check your connection</div>',error:'<small class="form-text text-muted"> {{msg}} </small>',sending:'<i class="fa fa-spinner fa-spin"></i> Sending...'},u={method:"POST",processData:!1,data:null},l={number:/^\d+$/,text:/.+/,email:/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,5})+$/,url:/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/,username:/^[a-zA-Z0-9\_]+$/},y=["checkbox","radio","file"],p=["username"],d={equal:function(s,t){return s===e(t).val()}};return r.prototype.inArray=function(e,s){return Array.isArray(s)===!1?!1:s.indexOf(e)>-1},r.prototype.getElements=function(s){return e(s+" input, textarea, select")},r.prototype.getValue=function(s){return"textarea"===s.type?e(s).text():"checkbox"===s.type||"radio"===s.type?e(s).is(":checked"):e(s).val()},r.prototype.getSubmyRules=function(e){var s=e.data("submy")||!1;return s!==!1&&"object"==typeof s?s:this.$submyOptions.rules!==i&&"object"==typeof this.$submyOptions.rules&&e.get(0).name in this.$submyOptions.rules?this.$submyOptions.rules[e.get(0).name]:!1},r.prototype.pregMatch=function(e,s){return new RegExp(e).test(s)},r.prototype.console=function(){return this.$submyOptions.errConsole===!0?console:{log:function(){},error:function(){},warn:function(){}}},r.prototype.fSize=function(e){return 1024>e?e+"bytes":1048576>e?(e/1024).toFixed(3)+"kb":1073741824>e?(e/1048576).toFixed(3)+"MB":(e/1073741824).toFixed(3)+"GB"},r.prototype.submySendRequest=function(){var s=e(this.$submyOptions.submitId),t=s.html(),r=e(this.$submyOptions.messageId),a=this,n=i;return r.html(""),s.html(this.$submyOptions.htmlMessages.sending).attr("disabled",!0),e.ajax(this.$submyOptions.ajax).done(function(s,t,m){try{n=e.parseJSON(s)}catch(o){n=i}return n!==i?a.$submyOptions.jsonDone!==!1&&"callback"==typeof a.$submyOptions.jsonDone?a.$submyOptions.jsonDone(s,t,m):n.type!==i&&n.message!==i?r.html(a.$submyOptions.htmlMessages.message.replace("{{type}}",n.type).replace("{{msg}}",n.message)).addClass("submyHtmlErrorMessage"):a.console().error("SubmyError: json data undefined"):a.$submyOptions.done!==!1&&"callback"==typeof a.$submyOptions.done?a.$submyOptions.done(s,t,m):r.html(a.$submyOptions.htmlMessages.message.replace("{{type}}","danger").replace("{{msg}}",s)).addClass("submyHtmlErrorMessage"),!1}).fail(function(e,s,t){return a.$submyOptions.error!==!1&&"callback"==typeof a.$submyOptions.error?(a.$submyOptions.error(e,s,t),!1):(r.html(a.$submyOptions.htmlMessages.message.replace("{{type}}","danger").replace("{{msg}}",e)).addClass("submyHtmlErrorMessage"),!1)}),s.html(t).attr("disabled",!1),!1},r.prototype.submyValidForm=function(){if(this.formElements===i)return this.console().error("SubmyError: formElements undefined"),!1;var s,t,r,a,n,m,o=0;for(e(this.$submyOptions.formId).data("submyIsValidForm",!1),e(".submyHtmlErrorMessage, .submyHtmlError").remove(),e(this.$submyOptions.submitId).attr("disabled",!0),this.$submyOptions.ajax.data=new FormData;o<this.formElements.length;o++)if(s=e(this.formElements[o]),t=this.getSubmyRules(s),r=this.getValue(this.formElements[o]),a=t!==!1&&t.type!==i?t.type:s.get(0).type,n=!1,m=null,"object"==typeof t&&t!==!1?(t.required=t.required!==i?t.required:!1,this.inArray(a,y)===!1?(t.required!==!1&&""===r.replace(/\s/g,"")&&(n=!0,m="boolean"==typeof t.required?this.$submyOptions.messages.required:t.required),a!==!1?(a in l&&n===!1&&this.pregMatch(l[a],r)===!1&&(n=!0,m=t.typeMessage!==i?t.typeMessage:this.$submyOptions.messages.notValid),this.inArray(a,p)===!0&&(a="text"),t.min=t.min!==i?t.min:!1,t.max=t.max!==i?t.max:!1,t.minMessage=t.minMessage!==i?t.minMessage:!1,t.maxMessage=t.maxMessage!==i?t.maxMessage:!1,"text"===a||"password"===a?(n===!1&&t.min!==!1&&r.length<t.min&&(n=!0,m=t.minMessage!==!1?t.minMessage:this.$submyOptions.messages.minTxt,m=m.replace("{{min}}",t.min)),n===!1&&t.max!==!1&&r.length>t.max&&(n=!0,m=t.maxMessage!==!1?t.maxMessage:this.$submyOptions.messages.maxTxt,m=m.replace("{{max}}",t.max))):"number"===a&&(n===!1&&t.min!==!1&&r<t.min&&(n=ture,m=t.minMessage!==!1?t.minMessage:this.$submyOptions.messages.minNum),n===!1&&t.max!==!1&&r>t.max&&(n=!0,m=t.maxMessage!==!1?t.maxMessage:this.$submyOptions.messages.maxNum),m=m.replace("{{min}}",t.min).replace("{{max}}",t.max)),n===!1&&t.is!==i&&Array.isArray(t.is)===!0&&2===t.is.length&&t.is[0]in d&&d[t.is[0]](r,t.is[1])===!1&&(n=!0,m=t.isEqualMessage!==i?t.isEqualMessage:this.$submyOptions.messages.isEqual)):this.console().warn("SubmyWarn: type not found in "+this.formElements[o].localName+" & name = "+this.formElements[o].name)):n!==!1||a===!1||"radio"!==a&&"checkbox"!==a||t.required===!1?a!==!1&&this.$submyOptions.fileUpload===!0&&"file"===a&&(n===!1&&s[0].files[0]===i&&t.required!==!1?(n=!0,m=t.required===!0?this.$submyOptions.fileMessages.required:t.required):n===!1&&t.types!==i&&Array.isArray(t.types)===!0&&this.inArray(s[0].files[0].type,t.types)===!1?(n=!0,m=t.typesMessage!==i?t.typesMessage:this.$submyOptions.fileMessages.type):n===!1&&t.minSize!==i&&s[0].files[0].size<t.minSize?(n=!0,m=t.minSizeMessage!==i?t.minSizeMessage:this.$submyOptions.fileMessages.minSize,m=m.replace("{{min}}",this.fSize(t.minSize))):n===!1&&t.maxSize!==i&&s[0].files[0].size>t.maxSize&&(n=!0,m=t.maxSizeMessage!==i?t.maxSizeMessage:this.$submyOptions.fileMessages.maxSize,m=m.replace("{{max}}",this.fSize(t.maxSize))),r=s[0].files[0]):r===!0?r=s.val():(n=!0,m=t.required===!0?this.$submyOptions.messages.required:t.required)):this.console().error("SubmyError: rules is not valid or not found in "+this.formElements[o].localName+" & name = "+this.formElements[o].name),n===!0){var u,h;u=t.showError!==i&&Array.isArray(t.showError)===!0?t.showError:this.$submyOptions.showError,h=this.$submyOptions.htmlMessages.error.replace("{{msg}}",m),h=e(h).addClass("submyHtmlError"),0===u.length?s.after(h):"before"===u[0]?e(u[1]).before(h):"after"===u[0]?e(u[1]).after(h):"in"===u[0]&&e(u[1]).html(h)}else this.$submyOptions.ajax.data.append(s.get(0).name,r);return 0===e(this.$submyOptions.formId).get(0).getElementsByClassName("submyHtmlError").length?(e(this.$submyOptions.submitId).attr("disabled",!1),e(this.$submyOptions.formId).data("submyIsValidForm",!0),!0):("submit"===this.$submyOptions.validOn&&e(this.$submyOptions.submitId).attr("disabled",!1),!1)},r.prototype.init=function(s,t){var r=null,a=0,n=e(s.selector);for(n.attr("method",this.$submyOptions.ajax.method),n.attr("accept-charset",this.$submyOptions.charset),n.data("submyIsValidForm",!1),this.$submyOptions.fileUpload===!0&&(n.attr("enctype","multipart/form-data"),this.$submyOptions.ajax.processData=!1,this.$submyOptions.ajax.contentType=!1),r=this.getElements(s.selector),this.formElements=r,this.$submyOptions.formId=s.selector,s=i;a<r.length;a++){var m=e(r[a]),o=this.getSubmyRules(m);o!==!1&&"object"==typeof o?o.type!==i&&(this.inArray(o.type,p)===!0?m.attr("type","text"):"textarea"!==m.get(0).localName&&m.attr("type",o.type),"file"===o.type&&(o.types=o.types!==i&&Array.isArray(o.types)===!0?o.types:["*/*"],m.attr("accept",o.types.join(", ")))):this.console().warn("submy: error data not valid or not found in "+m.get(0).localName+' and name="'+m.get(0).name+'"')}return n.on(this.$submyOptions.validOn,function(){if("submit"===t.$submyOptions.validOn){if(t.submyValidForm()===!0)try{t.submySendRequest()}catch(e){t.console().error(e)}}else t.submyValidForm();return!1}),"submit"!==this.$submyOptions.validOn&&e(this.$submyOptions.submitId).click(function(){if(n.data("submyIsValidForm")===!0)try{t.submySendRequest()}catch(e){t.console().error(e)}else t.submyValidForm();return!1}),!1},e.fn.submy=function(e){return new r(this,e)},!1}(jQuery,window,document);
